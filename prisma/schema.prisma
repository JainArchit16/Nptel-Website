generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId       Int       @id @default(autoincrement())
  name         String
  email        String    @unique
  passwordHash String
  quizzes      Quiz[]
  bookmarkedQuestions BookmarkedQuestion[]
  notes        Note[]
}

model Subject {
  subjectId Int       @id @default(autoincrement())
  name      String    @unique // e.g., "Mathematics", "Physics"
  quizzes   Quiz[]
  questions Question[]
  resources Resource[]
}

model Question {
  questionId    Int       @id @default(autoincrement())
  week          Int
  questionText  String
  options       String[]  // Array of options, e.g., ["True", "False"] or ["A", "B", "C", "D", "E"]
  correctOption Int       // Index of the correct option in the options array
  subjectId     Int
  subject       Subject   @relation(fields: [subjectId], references: [subjectId])
  userAnswers   UserAnswer[]
  bookmarkedQuestions BookmarkedQuestion[]
  notes         Note[]
}

model Quiz {
  quizId     Int       @id @default(autoincrement())
  userId     Int
  subjectId  Int
  week       Int
  score      Float
  accuracy   Float?
  timeTaken  Int?      // Stored in seconds
  user       User      @relation(fields: [userId], references: [userId])
  subject    Subject   @relation(fields: [subjectId], references: [subjectId])
  userAnswers UserAnswer[]
}

model UserAnswer {
  answerId   Int       @id @default(autoincrement())
  quizId     Int
  questionId Int
  selectedOption String
  isCorrect  Boolean
  quiz       Quiz      @relation(fields: [quizId], references: [quizId])
  question   Question  @relation(fields: [questionId], references: [questionId])
}

model BookmarkedQuestion {
  bookmarkId  Int       @id @default(autoincrement())
  userId      Int
  questionId  Int
  user        User      @relation(fields: [userId], references: [userId])
  question    Question  @relation(fields: [questionId], references: [questionId])
}

model Note {
  noteId      Int       @id @default(autoincrement())
  userId      Int
  questionId  Int
  noteText    String
  user        User      @relation(fields: [userId], references: [userId])
  question    Question  @relation(fields: [questionId], references: [questionId])
}

model Resource {
  resourceId Int    @id @default(autoincrement())
  subjectId  Int
  week       Int
  pptLink    String?
  videoLink  String?
  subject    Subject   @relation(fields: [subjectId], references: [subjectId])
}